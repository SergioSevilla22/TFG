<app-header></app-header>

<div class="equipo-wrapper" *ngIf="!loading && equipo; else loadingTpl">

  <!-- =====================================================
          CABECERA DEL EQUIPO
  ====================================================== -->
  <div class="equipo-header">
    
    <div class="left">
      <img 
        *ngIf="equipo.club.escudo"
        [src]="'http://localhost:3000' + equipo.club.escudo"
        class="escudo"
      />

      <div class="texto">
        <h1>{{ equipo.nombre }}</h1>
        <p>{{ equipo.club.nombre }}</p>
        <p>{{ equipo.categoria }} · {{ equipo.temporada }}</p>
      </div>
    </div>

    <button class="volver" (click)="volverAlClub()">← Volver al club</button>

  </div>

  <!-- =====================================================
          CUADRÍCULA PRINCIPAL
  ====================================================== -->
  <div class="grid-panel">

   <!-- TARJETA ENTRENADOR -->
   <div class="panel-card entrenador-card">

    <h3>Entrenadores ({{ equipo.entrenadores?.length || 0 }})</h3>
  
    <div *ngIf="equipo.entrenadores?.length; else noCoaches">
  
      <div class="jug-item" *ngFor="let e of equipo.entrenadores">
  
        <span class="round coach">
          {{ e.nombre[0] }}
        </span>
  
        <div>
          <h4>{{ e.nombre }}</h4>
          <p class="muted">DNI: {{ e.DNI }}</p>
        </div>
  
        <button
          class="delete"
          (click)="eliminarEntrenador(e.DNI)"
        >
          ✕
        </button>
  
      </div>
  
    </div>
  
    <ng-template #noCoaches>
      <p class="empty">No hay entrenadores asignados</p>
    </ng-template>
  
    <button
      class="cambiar primary"
      (click)="abrirModalEntrenadorEquipo()"
    >
      Añadir entrenador
    </button>
  
  </div>
  


    <!-- TARJETA JUGADORES -->
    <div 
      class="panel-card jugadores-card"
      (drop)="onDropJugador($event)"
      (dragover)="allowDrop($event)"
    >
      <h3>Jugadores ({{ equipo.jugadores.length }})</h3>

      <div class="jug-list" *ngIf="equipo.jugadores.length > 0; else noPlayers">

        <div 
          class="jug-item"
          *ngFor="let j of equipo.jugadores"
          draggable="true"
          (dragstart)="dragJugador($event, j.DNI)"
        >
          <span class="round">{{ j.nombre[0] }}</span>

          <div>
            <h4>{{ j.nombre }}</h4>
            <p>DNI: {{ j.DNI }}</p>
          </div>

          <button class="delete" (click)="eliminarJugador(j.DNI)">✕</button>
        </div>

      </div>

      <ng-template #noPlayers>
        <p class="empty">No hay jugadores en este equipo.</p>
      </ng-template>

    </div>

  </div>

  <button mat-raised-button color="primary"
        (click)="abrirModalAddJugadores()">
  ➕ Añadir jugadores
</button>

</div>

<ng-template #loadingTpl>
  <p class="loading">Cargando equipo...</p>
</ng-template>
