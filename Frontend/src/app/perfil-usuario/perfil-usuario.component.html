<app-header></app-header>
<div class="perfil-container">
  <!-- 游닞 Columna izquierda: Foto de perfil -->
  <div class="perfil-image">
    <div class="foto-area">
      <img [src]="getProfileImage()" alt="Foto de perfil" class="foto-perfil-redonda" />

      <div class="acciones-foto">
        <button *ngIf="!selectedFile"
                class="btn-editar-foto"
                (click)="fileInput.click()">
          Editar foto
        </button>
      
        <div *ngIf="selectedFile" class="acciones-edicion">
          <button class="btn-guardar-foto"
                  (click)="guardarSoloFoto()"
                  [disabled]="loading">
            Guardar
          </button>
      
          <button class="btn-cancelar-foto"
                  type="button"
                  (click)="cancelarFoto()">
            Cancelar
          </button>
        </div>
      
        <button class="btn-cambiar-pass" 
                (click)="toggleChangePass()">
          Cambiar contrase침a
        </button>
      
      </div>
      
      
      <input
        type="file"
        #fileInput
        style="display: none"
        (change)="onFileChange($event)"
        accept="image/*"
      />
    </div>

    <div class="change-pass-card" *ngIf="showChangePass">
      <h2>Cambiar contrase침a</h2>
      <form class="perfil-form">
        <label>Contrase침a actual</label>
        <input type="password" [(ngModel)]="actualPassword" name="actualPassword" placeholder="********" />
        
        <label>Nueva contrase침a</label>
        <input type="password" [(ngModel)]="nuevaPassword" name="nuevaPassword" placeholder="********" />
        
        <label>Confirmar nueva contrase침a</label>
        <input type="password" [(ngModel)]="confirmarPassword" name="confirmarPassword" placeholder="********" />
    
        <p *ngIf="passwordsNoCoinciden" class="error">Las contrase침as no coinciden</p>
    
        <div class="actions">
          <button class="btn-changepassword" type="button" (click)="onChangePassword()" [disabled]="loading || passwordsNoCoinciden">
            Guardar Contrase침a
          </button>
    
          <button type="button" (click)="toggleChangePass()">Cancelar</button>
        </div>
    
        <p *ngIf="passMessage" [class.success]="passSuccess" [class.error]="!passSuccess">
          {{ passMessage }}
        </p>
      </form>
    </div>
  </div>

  <div class="perfil-form-container">
    <div class="perfil-message">
      <h2>Mi Perfil</h2>
      <p>Consulta y edita tu informaci칩n personal</p>
    </div>

    <div *ngIf="user; else noUser" class="perfil-card">
      <div class="info" *ngIf="!editMode; else editForm">
        <p><strong>DNI:</strong> {{ user.DNI }}</p>
        <p><strong>Nombre:</strong> {{ user.nombre }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Tel칠fono:</strong> {{ user.telefono }}</p>
        <p><strong>Rol:</strong> {{ user.Rol }}</p>
        <div class="actions">
          <button (click)="toggleEdit()">Editar perfil</button>
          <button class="btn-logout" (click)="logout()">Cerrar sesi칩n</button>
        </div>
      </div>

      <ng-template #editForm>
        <form class="perfil-form">
          <label>Nombre</label>
          <input [(ngModel)]="user.nombre" name="nombre" />

          <label>Email</label>
          <input [(ngModel)]="user.email" name="email" />

          <label>Tel칠fono</label>
          <input [(ngModel)]="user.telefono" name="telefono" />

          <label>Rol</label>
          <select [(ngModel)]="user.Rol" name="Rol">
            <option value="jugador">Jugador</option>
            <option value="entrenador">Entrenador</option>
            <option value="admin">Administrador</option>
          </select>

          <div class="actions">
            <button type="button" (click)="guardarCambios()" [disabled]="loading">
              {{ loading ? 'Guardando...' : 'Guardar cambios' }}
            </button>
            <button type="button" (click)="toggleEdit()">Cancelar</button>
          </div>

          <p *ngIf="errorMsg" class="error">{{ errorMsg }}</p>
        </form>
      </ng-template>
    </div>

    <ng-template #noUser>
      <p>No hay usuario logueado.</p>
    </ng-template>
  </div>
</div>
