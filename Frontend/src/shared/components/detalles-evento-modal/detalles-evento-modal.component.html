<div class="modal-header">
  <h2 mat-dialog-title>{{ detalles?.titulo || (detalles?.rival ? 'Partido vs ' + detalles.rival : 'Detalles') }}</h2>
  <span 
  class="badge"
  [ngClass]="'badge-' + tipoBadge"
  *ngIf="detalles"
>
  {{ tipoBadge | uppercase }}
</span>
</div>

<mat-dialog-content class="content">

  <!-- LOADING -->
  <div *ngIf="loading" class="loader">Cargando detalles...</div>

  <!-- CONTENIDO -->
  <ng-container *ngIf="!loading && detalles">

    <!-- ===================== -->
    <!-- DETALLES DEL EVENTO -->
    <!-- ===================== -->
    <div class="info-grid">
      <div>
        <label>Fecha</label>
        <p>
          {{ detalles.fecha_partido || detalles.fecha_inicio | date:'dd/MM/yyyy' }}
        </p>
      </div>

      <div>
        <label>Hora</label>
        <p>
          {{ detalles.hora || (detalles.hora_inicio || '-') }}
        </p>
      </div>

      <div *ngIf="detalles.lugar">
        <label>Lugar</label>
        <p>{{ detalles.lugar }}</p>
      </div>

      <div *ngIf="detalles.rival">
        <label>Rival</label>
        <p>{{ detalles.rival }}</p>
      </div>

      <div *ngIf="detalles.descripcion" style="grid-column: span 2;">
        <label>Descripción</label>
        <p>{{ detalles.descripcion }}</p>
      </div>
    </div>

    <!-- ===================== -->
    <!-- SECCIÓN JUGADOR -->
    <!-- ===================== -->
    <section *ngIf="authService.hasRole('jugador')">

      <div class="msg-box info" *ngIf="!estaConvocado">
        No estás convocado para este evento.
      </div>

      <ng-container *ngIf="estaConvocado">

        <!-- YA RESPONDIDO -->
        <div class="status-confirmed" *ngIf="estadoActual && estadoActual !== 'pendiente'">
          Has respondido:
          <span class="badge-estado" [ngClass]="estadoActual">
            {{ estadoActual | uppercase }}
          </span>
        </div>

        <!-- PUEDE RESPONDER -->
        <div
          class="acciones-jugador"
          *ngIf="(estadoActual === 'pendiente' || !estadoActual) && !cerrada && !esPasado">

          <h3>¿Confirmas tu asistencia?</h3>

          <div class="botones-respuesta">
            <button class="btn confirm" (click)="responder('confirmado')">
              Confirmar
            </button>
            <button class="btn reject" (click)="responder('rechazado')">
              Rechazar
            </button>
            <textarea
  *ngIf="estadoActual === 'pendiente'"
  [(ngModel)]="motivo"
  placeholder="Indica el motivo"
></textarea>
          </div>
        </div>

        <!-- FUERA DE PLAZO -->
        <div class="msg-box warning" *ngIf="cerrada || esPasado">
          El plazo de respuesta ha finalizado.
        </div>

      </ng-container>
    </section>

    <!-- ===================== -->
    <!-- RESUMEN ENTRENADOR / ADMIN -->
    <!-- ===================== -->
    <section *ngIf="!authService.hasRole('jugador')" class="resumen-asistencia">
      <h3>Resumen de asistencia</h3>

      <div class="pills">
        <span class="pill confirmado">✔ {{ contar('confirmado') }}</span>
        <span class="pill rechazado">✖ {{ contar('rechazado') }}</span>
        <span class="pill pendiente">⏳ {{ contar('pendiente') }}</span>
      </div>
    </section>

  </ng-container>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="dialogRef.close(false)">Cerrar</button>
</mat-dialog-actions>